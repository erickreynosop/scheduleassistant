{% extends "base.html" %}
{% set calendar_page = True %}
{% block content %}
  <!-- Page heading (top-left, outside any cards) -->
  <div style="
    position: absolute;
    top: 20px;
    left: 20px;
    font-size: 2.2rem;
    font-weight: 800;
  ">
    üìÖ Calendar
  </div>

  <!-- Outer wrapper -->
  <div style="
    position: relative;
    width: 200%;
    max-width: 2000px;
    left: 50%;
    transform: translateX(-50%);
  ">

    <!-- Month/Year header bar -->
    <div style="
      background: var(--card);
      border: 1px solid #e6e6e6;
      border-radius: 16px 16px 0 0;
      padding: 20px;
      text-align: center;
      font-size: 1.8rem;
      font-weight: 700;
      box-shadow: 0 5px 15px rgba(0,0,0,.05);
      width: 100%;
      box-sizing: border-box;
      position: relative;
    ">
      {{ month_name }} {{ year }}

      <!-- Prev / Next inside the header bar -->
      <div style="
        position: absolute;
        top: 50%;
        transform: translateY(-50%);
        left: 20px;
        font-size: 1rem;
      ">
        <a href="{{ url_for('calendar_view', year=prev_year, month=prev_month) }}">‚Üê Prev</a>
        <a href="{{ url_for('calendar_view', year=next_year, month=next_month) }}" style="margin-left:16px;">Next ‚Üí</a>
      </div>
    </div>

    <!-- Calendar card -->
    <div style="
      display: inline-block;
      width: 100%;
      background: var(--card);
      border: 1px solid #e6e6e6;
      border-top: none;
      border-radius: 0 0 16px 16px;
      padding: 20px;
      box-shadow: 0 10px 30px rgba(0,0,0,.08);
      box-sizing: border-box;
    ">
      <!-- Calendar Grid -->
      <div style="display:grid; grid-template-columns: repeat(7, 1fr); gap:12px;">
        {% for wd in ['Sun','Mon','Tue','Wed','Thu','Fri','Sat'] %}
          <div class="muted" style="text-align:center; font-weight:700; font-size:1rem;">
            {{ wd }}
          </div>
        {% endfor %}

        {% for week in weeks %}
          {% for day in week %}
            <div style="
              min-height:180px;
              background:#fff;
              border:1px solid #ddd;
              border-radius:10px;
              padding:8px;
              font-size:.9rem;
            ">
              {% if day == 0 %}
                <div class="muted" style="height:20px;"></div>
              {% else %}
                <div style="font-weight:700; font-size:1.1rem; margin-bottom:4px;">{{ day }}</div>
                {% set items = appts_by_day.get(day, []) %}
                {% if items %}
                  <div style="margin-top:6px; display:flex; flex-direction:column; gap:8px;">
                    {% for a in items %}
                      <div style="display:flex; align-items:flex-start; gap:8px;">
                        {% if is_boss and not a.canceled %}
                          <form method="post"
                                action="{{ url_for('boss_cancel', appt_id=a.id) }}?year={{ year }}&month={{ month }}"
                                onsubmit="return confirm('Cancel this appointment?');"
                                style="margin:0;">
                            <button type="submit" title="Cancel"
                              style="background:none; border:none; color:#dc3545; font-weight:bold; font-size:1rem; cursor:pointer; padding:0; margin:0;">
                              ‚ùå
                            </button>
                          </form>
                        {% elif a.canceled %}
                          <span class="pill pill-danger" title="Canceled">Canceled</span>
                        {% endif %}

                        <div style="flex:1;">
                          <div class="{{ 'canceled' if a.canceled else '' }}">
                            <strong>{{ a.title }}</strong>
                            {% if is_boss %}<span class="muted">‚Ä¢ {{ a.user.fullname }}</span>{% endif %}
                          </div>
                          <div class="muted">{{ a.start_at.strftime('%I:%M %p') }}</div>
                          {% if a.services %}
                            <div class="{{ 'canceled' if a.canceled else '' }}" style="font-size:.85rem;">
                              {{ a.services }}
                            </div>
                          {% endif %}
                        </div>
                      </div>
                    {% endfor %}
                  </div>
                {% endif %}
              {% endif %}
            </div>
          {% endfor %}
        {% endfor %}
      </div>
    </div>

    <!-- Footer link: boss can't go to /main, so show Logout instead -->
    <div class="links" style="margin-top:15px; text-align:center;">
      {% if is_boss %}
        <a href="{{ url_for('logout') }}">Logout</a>
      {% else %}
        <a href="{{ url_for('main') }}">Back to Main Menu</a>
      {% endif %}
    </div>
  </div>
{% endblock %}
